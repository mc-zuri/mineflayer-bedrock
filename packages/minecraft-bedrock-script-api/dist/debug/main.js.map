{"version":3,"sources":["../../scripts/main.ts"],"sourcesContent":["import { world, system, GameMode, Vector3, Entity, EntityMovementComponent } from \"@minecraft/server\";\r\nimport * as GameTest from \"@minecraft/server-gametest\";\r\n\r\nfunction getMovementSpeed(entity: GameTest.SimulatedPlayer): number | undefined {\r\n  const movement = entity.getComponent(\"minecraft:movement\") as EntityMovementComponent | undefined;\r\n  return movement?.currentValue;\r\n}\r\n\r\nfunction logEntityAttributes(entity: GameTest.SimulatedPlayer, name: string) {\r\n  const movement = entity.getComponent(\"minecraft:movement\") as EntityMovementComponent | undefined;\r\n  if (movement) {\r\n    console.warn(`[${name}] Movement - default: ${movement.defaultValue}, current: ${movement.currentValue}`);\r\n    world.sendMessage(`§d[${name}] Movement speed: ${movement.currentValue}`);\r\n  }\r\n}\r\n\r\nfunction setMovementSpeed(entity: GameTest.SimulatedPlayer, speed: number): boolean {\r\n  const movement = entity.getComponent(\"minecraft:movement\") as EntityMovementComponent | undefined;\r\n  if (movement) {\r\n    movement.setCurrentValue(speed);\r\n    return true;\r\n  }\r\n  return false;\r\n}\r\n\r\ninterface VelocityData {\r\n  tick: number;\r\n  x: number;\r\n  y: number;\r\n  z: number;\r\n  speed: number;\r\n  horizontalSpeed: number;\r\n}\r\n\r\nconst TICKS_TO_RECORD = 6000;\r\n\r\nfunction calculateSpeed(v: Vector3): number {\r\n  return Math.sqrt(v.x ** 2 + v.y ** 2 + v.z ** 2);\r\n}\r\n\r\nfunction calculateHorizontalSpeed(v: Vector3): number {\r\n  return Math.sqrt(v.x ** 2 + v.z ** 2);\r\n}\r\n\r\nfunction printResults(testName: string, data: VelocityData[]) {\r\n  const log = (msg: string) => {\r\n    console.warn(msg);  // console.warn shows in BDS console\r\n    world.sendMessage(msg);\r\n  };\r\n\r\n  log(`§e=== ${testName} Movement Test ===`);\r\n\r\n  // Just show summary to avoid chat spam\r\n  const maxSpeed = Math.max(...data.map(d => d.horizontalSpeed));\r\n  const avgSpeed = data.reduce((sum, d) => sum + d.horizontalSpeed, 0) / data.length;\r\n\r\n  log(`§aMax H.Speed: ${maxSpeed.toPrecision(10)} blocks/tick (${(maxSpeed * 20).toPrecision(10)} blocks/sec)`);\r\n  log(`§bAvg H.Speed: ${avgSpeed.toPrecision(10)} blocks/tick (${(avgSpeed * 20).toPrecision(10)} blocks/sec)`);\r\n\r\n  // Log full data to console only\r\n  console.warn(\"Tick | Velocity (x, y, z) | Speed | H.Speed\");\r\n  for (const d of data) {\r\n    const velStr = `(${d.x.toPrecision(21)}, ${d.y.toPrecision(21)}, ${d.z.toPrecision(21)})`;\r\n    console.warn(`${d.tick.toString().padStart(4)} | ${velStr} | ${d.speed} | ${d.horizontalSpeed}`);\r\n  }\r\n}\r\n\r\n// Test: WALK movement\r\nGameTest.registerAsync(\"velocity\", \"walk_test\", async (test) => {\r\n  const player = test.spawnSimulatedPlayer({ x: 100, y: 2, z: 100 }, \"Walker\");\r\n  const data: VelocityData[] = [];\r\n\r\n  await test.idle(10);\r\n  logEntityAttributes(player, \"Walker\");\r\n  // Start walking forward\r\n  player.move(0, 1);\r\n\r\n  for (let tick = 0; tick < TICKS_TO_RECORD; tick++) {\r\n    const velocity = player.getVelocity();\r\n    data.push({\r\n      tick,\r\n      x: velocity.x,\r\n      y: velocity.y,\r\n      z: velocity.z,\r\n      speed: calculateSpeed(velocity),\r\n      horizontalSpeed: calculateHorizontalSpeed(velocity),\r\n    });\r\n    await test.idle(1);\r\n  }\r\n\r\n  player.stopMoving();\r\n  printResults(\"WALK\", data);\r\n  test.succeed();\r\n})\r\n.maxTicks(TICKS_TO_RECORD+100)\r\n.tag(\"velocity\");\r\n\r\n// Test: SNEAK movement\r\nGameTest.registerAsync(\"velocity\", \"sneak_test\", async (test) => {\r\n  const player = test.spawnSimulatedPlayer({ x: 100, y: 2, z: 100 }, \"Sneaker\");\r\n  const data: VelocityData[] = [];\r\n\r\n  // Start sneaking and moving\r\n  await test.idle(10);\r\n  player.isSneaking = true;\r\n  logEntityAttributes(player, \"Sneaker (sneaking)\");\r\n  player.move(0, 1);\r\n\r\n  for (let tick = 0; tick < TICKS_TO_RECORD; tick++) {\r\n    const velocity = player.getVelocity();\r\n    data.push({\r\n      tick,\r\n      x: velocity.x,\r\n      y: velocity.y,\r\n      z: velocity.z,\r\n      speed: calculateSpeed(velocity),\r\n      horizontalSpeed: calculateHorizontalSpeed(velocity),\r\n    });\r\n    await test.idle(1);\r\n  }\r\n\r\n  player.stopMoving();\r\n  printResults(\"SNEAK\", data);\r\n  test.succeed();\r\n})\r\n.maxTicks(TICKS_TO_RECORD+100)\r\n.tag(\"velocity\");\r\n\r\n// Test: SPRINT movement\r\nGameTest.registerAsync(\"velocity\", \"sprint_test\", async (test) => {\r\n  const player = test.spawnSimulatedPlayer({ x: 100, y: 2, z: 100 }, \"Sprinter\");\r\n  const data: VelocityData[] = [];\r\n\r\n  await test.idle(10);\r\n  // Start sprinting\r\n  player.isSprinting = true;\r\n  logEntityAttributes(player, \"Sprinter (sprinting)\");\r\n  player.move(0, 1);\r\n\r\n  for (let tick = 0; tick < TICKS_TO_RECORD; tick++) {\r\n    const velocity = player.getVelocity();\r\n    data.push({\r\n      tick,\r\n      x: velocity.x,\r\n      y: velocity.y,\r\n      z: velocity.z,\r\n      speed: calculateSpeed(velocity),\r\n      horizontalSpeed: calculateHorizontalSpeed(velocity),\r\n    });\r\n    await test.idle(1);\r\n  }\r\n\r\n  player.stopMoving();\r\n  printResults(\"SPRINT\", data);\r\n  test.succeed();\r\n})\r\n.maxTicks(TICKS_TO_RECORD+100)\r\n.tag(\"velocity\");\r\n\r\n// Test: WALK with fixed speed 0.1\r\nGameTest.registerAsync(\"velocity\", \"walk_fixed_test\", async (test) => {\r\n  const player = test.spawnSimulatedPlayer({ x: 100, y: 2, z: 100 }, \"FixedWalker\");\r\n  const data: VelocityData[] = [];\r\n\r\n  await test.idle(10);\r\n  // Set speed to exactly 0.1\r\n  //setMovementSpeed(player, 0.1);\r\n  logEntityAttributes(player, \"FixedWalker (speed=0.1)\");\r\n  // Start walking forward\r\n  player.move(0, 1);\r\n\r\n  for (let tick = 0; tick < TICKS_TO_RECORD; tick++) {\r\n    const velocity = player.getVelocity();\r\n    data.push({\r\n      tick,\r\n      x: velocity.x,\r\n      y: velocity.y,\r\n      z: velocity.z,\r\n      speed: calculateSpeed(velocity),\r\n      horizontalSpeed: calculateHorizontalSpeed(velocity),\r\n    });\r\n    await test.idle(1);\r\n  }\r\n\r\n  player.stopMoving();\r\n  printResults(\"WALK (speed=0.1)\", data);\r\n  test.succeed();\r\n})\r\n.maxTicks(TICKS_TO_RECORD+100)\r\n.tag(\"velocity\");\r\n\r\n// Test: SPRINT with fixed speed 0.1 (no sprint bonus)\r\nGameTest.registerAsync(\"velocity\", \"sprint_fixed_test\", async (test) => {\r\n  const player = test.spawnSimulatedPlayer({ x: 100, y: 2, z: 100 }, \"FixedSprinter\");\r\n  const data: VelocityData[] = [];\r\n\r\n  await test.idle(10);\r\n  player.isSprinting = true;\r\n  // Set speed to exactly 0.1 AFTER enabling sprint\r\n  //setMovementSpeed(player, 0.1);\r\n  logEntityAttributes(player, \"FixedSprinter (sprint+speed=0.1)\");\r\n  player.move(0, 1);\r\n\r\n  for (let tick = 0; tick < TICKS_TO_RECORD; tick++) {\r\n    const velocity = player.getVelocity();\r\n    data.push({\r\n      tick,\r\n      x: velocity.x,\r\n      y: velocity.y,\r\n      z: velocity.z,\r\n      speed: calculateSpeed(velocity),\r\n      horizontalSpeed: calculateHorizontalSpeed(velocity),\r\n    });\r\n    await test.idle(1);\r\n  }\r\n\r\n  player.stopMoving();\r\n  printResults(\"SPRINT (speed=0.1)\", data);\r\n  test.succeed();\r\n})\r\n.maxTicks(TICKS_TO_RECORD+100)\r\n.tag(\"velocity\");\r\n\r\nconsole.log(\"[Script API] Velocity tests registered\");\r\nconsole.log(\"[Script API] Run: /gametest run velocity:walk_test\");\r\nconsole.log(\"[Script API] Run: /gametest run velocity:sneak_test\");\r\nconsole.log(\"[Script API] Run: /gametest run velocity:sprint_test\");\r\nconsole.log(\"[Script API] Or run all: /gametest runset velocity\");\r\n"],"mappings":"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","names":[],"file":"../scripts/main.js"}